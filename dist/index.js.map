{"version":3,"file":"index.js","sources":["../src/regex/defaultRegex.ts","../src/utils/getDeepObj.ts","../src/rules.ts/if.ts","../src/rules.ts/for.ts","../src/rules.ts/if_not.ts","../src/rules.ts/display_data.ts","../src/rules.ts/display_original_data.ts","../src/rules.ts/comment.ts","../src/rules.ts/index.ts","../src/regex/builder.ts","../src/index.ts"],"sourcesContent":["const REG: { [key: string]: string } = {\r\n  START_CODE: String.raw`{{`,\r\n  END_CODE: String.raw`}}`,\r\n\r\n  CONTENT: String.raw`[^\\[\\]]+?`,\r\n  CONTENT_MULTILINE: String.raw`[\\s\\S]*?`,\r\n\r\n  OPTIONAL_SPACE: String.raw`[\\s\\t]*`,\r\n  OPTIONAL_SPACE_MULTILINE: String.raw`[\\s\\t\\n]*`,\r\n\r\n  INSTRUCTION_START: String.raw`\\[`,\r\n  INSTRUCTION_END: String.raw`\\]`,\r\n};\r\n\r\nexport default REG;\r\n","function getDeepObj(obj: any, path: string, context?: any): any {\r\n  const pathes: string[] = path\r\n    .replace(/\\[(\\d+)\\]/gi, (_m: string, nb: string) => `.${nb}`) //obj[0] -> obj.0\r\n    .split(\".\");\r\n\r\n  let value: any = obj;\r\n\r\n  if (typeof value === \"function\") value = value.call(context ?? obj);\r\n\r\n  if (pathes[0] === \"this\") {\r\n    pathes.shift();\r\n  }\r\n\r\n  for (const key of pathes) {\r\n    if (!value[key]) return \"\";\r\n    value = value[key];\r\n\r\n    if (typeof value === \"function\") value = value.call(context ?? obj);\r\n  }\r\n\r\n  return value;\r\n}\r\n\r\nexport default getDeepObj;\r\n","import getDeepObj from \"../utils/getDeepObj\";\r\nimport { RULE } from \"./index\";\r\nimport { Data } from \"../utils/dataType\";\r\n\r\nconst IF: RULE = {\r\n  open: \"IF\",\r\n  close: \"END IF\",\r\n  fn: function (\r\n    _m: string,\r\n    template: string,\r\n    content: string,\r\n    data: Data,\r\n    originalData: Data,\r\n    callback: Function\r\n  ) {\r\n    const value = getDeepObj(data, content);\r\n    if (value && template) {\r\n      return callback(template, data);\r\n    }\r\n    return \"\";\r\n  },\r\n};\r\n\r\nexport default IF;\r\n","import getDeepObj from \"../utils/getDeepObj\";\r\nimport { RULE } from \"./index\";\r\nimport { Data } from \"../utils/dataType\";\r\n\r\nconst FOR: RULE = {\r\n  open: \"FOR\",\r\n  close: \"END FOR\",\r\n  fn: function (\r\n    _m: string,\r\n    template: string,\r\n    content: string,\r\n    data: Data,\r\n    originalData: Data,\r\n    callback: Function\r\n  ) {\r\n    const items = getDeepObj(data, content);\r\n    if (!(items instanceof Array)) return \"\";\r\n    return items\r\n      .map((e: Data) => callback(template, e, originalData))\r\n      .join(\"\\n\");\r\n  },\r\n};\r\n\r\nexport default FOR;\r\n","import getDeepObj from \"../utils/getDeepObj\";\r\nimport { RULE } from \"./index\";\r\nimport { Data } from \"../utils/dataType\";\r\n\r\nconst IF_NOT: RULE = {\r\n  open: \"IF NOT\",\r\n  close: \"END IF NOT\",\r\n  fn: function (\r\n    _m: string,\r\n    template: string,\r\n    content: string,\r\n    data: Data,\r\n    originalData: Data,\r\n    callback: Function\r\n  ) {\r\n    const value = getDeepObj(data, content);\r\n    if (!value && template) {\r\n      return callback(template, data);\r\n    }\r\n    return \"\";\r\n  },\r\n};\r\n\r\nexport default IF_NOT;\r\n","import getDeepObj from \"../utils/getDeepObj\";\r\nimport { RULE } from \"./index\";\r\nimport { Data } from \"../utils/dataType\";\r\n\r\nconst DATA: RULE = {\r\n  open: \"\",\r\n  fn: function (_m: string, template: string, content: string, data: Data) {\r\n    return getDeepObj(data, content);\r\n  },\r\n};\r\n\r\nexport default DATA;\r\n","import getDeepObj from \"../utils/getDeepObj\";\r\nimport { RULE } from \"./index\";\r\nimport { Data } from \"../utils/dataType\";\r\n\r\nconst ORIGINAL_DATA: RULE = {\r\n  open: \">\",\r\n  fn: function (\r\n    _m: string,\r\n    template: string,\r\n    content: string,\r\n    data: Data,\r\n    originalData: Data\r\n  ) {\r\n    return getDeepObj(originalData, content, data);\r\n  },\r\n};\r\n\r\nexport default ORIGINAL_DATA;\r\n","import { RULE } from \"./index\";\r\nimport { Data } from \"../utils/dataType\";\r\n\r\nconst COMMENT: RULE = {\r\n  open: \"@@\",\r\n  multilines: true,\r\n  fn: function (_m: string, template: string, content: string, data: Data) {\r\n    return \"\";\r\n  },\r\n};\r\n\r\nexport default COMMENT;\r\n","import IF from \"./if\";\r\nimport FOR from \"./for\";\r\nimport IF_NOT from \"./if_not\";\r\nimport DATA from \"./display_data\";\r\nimport ORIGINAL_DATA from \"./display_original_data\";\r\nimport COMMENT from \"./comment\";\r\nimport { Data } from \"../utils/dataType\";\r\n\r\nexport type RULE = {\r\n  open: string;\r\n  close?: string;\r\n  multilines?: boolean;\r\n  fn: (\r\n    _m: string,\r\n    template: string,\r\n    content: string,\r\n    data: Data,\r\n    originalData: Data,\r\n    callback: Function\r\n  ) => string;\r\n};\r\n\r\n//the order is pretty important\r\nconst RULES: {\r\n  [key: string]: RULE;\r\n} = {\r\n  COMMENT: COMMENT,\r\n  IF: IF,\r\n  IF_NOT: IF_NOT,\r\n  FOR: FOR,\r\n  ORIGINAL_DATA: ORIGINAL_DATA,\r\n  DATA: DATA,\r\n};\r\n\r\nexport default RULES;\r\n","import REG from \"./defaultRegex\";\r\nimport RULES from \"../rules.ts\";\r\n\r\nfunction generateRegex() {\r\n  const regexList: string[] = [];\r\n\r\n  for (const RULE of Object.values(RULES)) {\r\n    const SPACE = RULE.multilines\r\n      ? REG.OPTIONAL_SPACE_MULTILINE\r\n      : REG.OPTIONAL_SPACE;\r\n    const START = String.raw`${REG.START_CODE}${SPACE}`;\r\n    const END = String.raw`${SPACE}${REG.END_CODE}`;\r\n    const OPENER = RULE.open\r\n      ? String.raw`${REG.INSTRUCTION_START}${SPACE}(${RULE.open})${SPACE}${REG.INSTRUCTION_END}${SPACE}`\r\n      : String.raw`(${RULE.open})`;\r\n    const CLOSER = !!RULE.close\r\n      ? String.raw`${REG.INSTRUCTION_START}${SPACE}(${RULE.close})${SPACE}${REG.INSTRUCTION_END}${SPACE}\\2`\r\n      : false;\r\n    const CONTENT = String.raw`(${REG.CONTENT})`;\r\n\r\n    regexList.push(\r\n      CLOSER\r\n        ? String.raw`${START}${OPENER}${CONTENT}${END}\\n?(${REG.CONTENT_MULTILINE})\\n?${START}${CLOSER}${END}`\r\n        : String.raw`${START}${OPENER}${CONTENT}${END}\\n?`\r\n    );\r\n  }\r\n\r\n  return regexList.map((e) => new RegExp(e, \"gim\"));\r\n}\r\n\r\nexport default generateRegex;\r\n","import generateRegex from \"./regex/builder\";\r\nimport REG from \"./regex/defaultRegex\";\r\nimport RULES from \"./rules.ts\";\r\nimport { RULE } from \"./rules.ts/index\";\r\n\r\nfunction muswish(template: string, data: any, originalData?: any): string {\r\n  return muswish.TEMPLATING_REG.reduce(\r\n    (a, b) =>\r\n      (a = a.replace(\r\n        b,\r\n        function (\r\n          _match: string,\r\n          opener: string,\r\n          content: string,\r\n          template: string,\r\n          close: string\r\n        ) {\r\n          const handler = Object.values(RULES).find(\r\n            (e) => e.open?.toLowerCase() == opener?.toLowerCase()\r\n          );\r\n          if (handler) {\r\n            return handler.fn(\r\n              _match,\r\n              template,\r\n              content,\r\n              data,\r\n              originalData ?? data,\r\n              muswish\r\n            );\r\n          }\r\n          return _match;\r\n        }\r\n      )),\r\n    template\r\n  );\r\n}\r\n\r\nmuswish.TEMPLATING_REG = generateRegex();\r\n\r\nmuswish.addPlugin = function (name: string, rule: RULE) {\r\n  RULES[name] = rule;\r\n  muswish.TEMPLATING_REG = generateRegex();\r\n};\r\n\r\nmuswish.customDelimiters = function (opener: string, closer: string) {\r\n  REG.START_CODE = opener;\r\n  REG.END_CODE = closer;\r\n  muswish.TEMPLATING_REG = generateRegex();\r\n};\r\n\r\nexport default muswish;\r\n"],"names":[],"mappings":"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"}